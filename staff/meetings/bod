#!/usr/bin/env python3
import argparse
from os.path import join

import meetings


def quorum():
    print(meetings.quorum())


def ls():
    for user, status in meetings.ls().items():
        print(user, status)


def danger():
    path = meetings.get_current_minutes_path('bod')
    minutes = meetings.get_minutes(path)
    if len(minutes) > 0:
        bod = set(meetings.ls(state='bod'))
        attended_last_meeting = set(meetings.attendance(join(path, minutes[-1])))
        for user in bod - attended_last_meeting:
            print(user)


# update membership file based on minutes in current semester
def update():
    meetings.update_membership()


if __name__ == '__main__':

    parser = argparse.ArgumentParser()
    commands = {
        'quorum': quorum,  # lists number of people currently needed for quorum
        'ls': ls,  # lists people on bod
        # lists people in "danger" of being kicked off, i.e. people who missed
        # last meeting on bod
        'danger': danger,
        'update': update,
    }
    parser.add_argument('command', type=str, choices=commands.keys())

    args = parser.parse_args()
    commands[args.command]()
